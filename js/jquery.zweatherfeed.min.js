(function(k){k.fn.weatherfeed=function(q,f,x){f=k.extend({unit:"c",image:!0,country:!1,highlow:!0,wind:!0,humidity:!1,visibility:!1,sunrise:!1,sunset:!1,forecast:!1,forecastdays:5,link:!0,showerror:!0,linktarget:"_self",woeid:!1,refresh:0},f);var m="odd";return this.each(function(p,t){function y(f,c,e){m="odd";g.html("");k.ajax({type:"GET",url:c,dataType:"json",success:function(a){if(a.query){if(0<a.query.results.channel.length)for(var c=a.query.results.channel.length,b=0;b<c;b++)z(t,a.query.results.channel[b],
e);else z(t,a.query.results.channel,e);k.isFunction(x)&&x.call(this,g)}else e.showerror&&g.html("<p>Weather information unavailable</p>")},error:function(a){e.showerror&&g.html("<p>Weather request failed</p>")}})}var g=k(t);g.hasClass("weatherFeed")||g.addClass("weatherFeed");if(!k.isArray(q))return!1;var u=q.length;10<u&&(u=10);var l="";for(p=0;p<u;p++)""!=l&&(l+=","),l+="'"+q[p]+"'";now=new Date;var v="select * from weather.forecast where "+(f.woeid?"woeid":"location")+" in ("+l+") and u='"+f.unit+
"'",A="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(v)+"&rnd="+now.getFullYear()+now.getMonth()+now.getDay()+now.getHours()+"&format=json&callback=?";y(v,A,f);0<f.refresh&&setInterval(function(){y(v,A,f)},6E4*f.refresh);var z=function(f,c,e){f=k(f);if("Yahoo! Weather Error"!=c.description){var a=c.wind.direction;348.75<=a&&360>=a&&(a="N");0<=a&&11.25>a&&(a="N");11.25<=a&&33.75>a&&(a="NNE");33.75<=a&&56.25>a&&(a="NE");56.25<=a&&78.75>a&&(a="ENE");78.75<=a&&101.25>a&&(a="E");101.25<=
a&&123.75>a&&(a="ESE");123.75<=a&&146.25>a&&(a="SE");146.25<=a&&168.75>a&&(a="SSE");168.75<=a&&191.25>a&&(a="S");191.25<=a&&213.75>a&&(a="SSW");213.75<=a&&236.25>a&&(a="SW");236.25<=a&&258.75>a&&(a="WSW");258.75<=a&&281.25>a&&(a="W");281.25<=a&&303.75>a&&(a="WNW");303.75<=a&&326.25>a&&(a="NW");326.25<=a&&348.75>a&&(a="NNW");var g=c.item.forecast[0];wpd=c.item.pubDate;n=wpd.indexOf(":");tpb=w(wpd.substr(n-2,8));tsr=w(c.astronomy.sunrise);tss=w(c.astronomy.sunset);daynight=tpb>tsr&&tpb<tss?"day":"night";
var b='<div class="weatherItem '+m+" "+daynight+'"';e.image&&(b+=' style="background-image: url(http://l.yimg.com/a/i/us/nws/weather/gr/'+c.item.condition.code.substring(0,2)+daynight.substring(0,1)+'.png); background-repeat: no-repeat;"');b=b+">"+('<div class="weatherCity">'+c.location.city+"</div>");e.country&&(b+='<div class="weatherCountry">'+c.location.country+"</div>");b+='<div class="weatherTemp">'+c.item.condition.temp+"&deg;</div>";b+='<div class="weatherDesc">'+c.item.condition.text+"</div>";
e.highlow&&(b+='<div class="weatherRange">High: '+g.high+"&deg; Low: "+g.low+"&deg;</div>");e.wind&&(b+='<div class="weatherWind">Wind: '+a+" "+c.wind.speed+c.units.speed+"</div>");e.humidity&&(b+='<div class="weatherHumidity">Humidity: '+c.atmosphere.humidity+"</div>");e.visibility&&(b+='<div class="weatherVisibility">Visibility: '+c.atmosphere.visibility+"</div>");e.sunrise&&(b+='<div class="weatherSunrise">Sunrise: '+c.astronomy.sunrise+"</div>");e.sunset&&(b+='<div class="weatherSunset">Sunset: '+
c.astronomy.sunset+"</div>");if(e.forecast){b+='<div class="weatherForecast">';a=c.item.forecast;g=e.forecastdays;g>a.length&&(g=a.length);for(var h=0;h<g;h++)b+='<div class="weatherForecastItem day'+(h+1)+'" style="background-image: url(http://l.yimg.com/a/i/us/nws/weather/gr/'+a[h].code+'s.png); background-repeat: no-repeat;">',b+='<div class="weatherForecastDay">'+a[h].day+"</div>",b+='<div class="weatherForecastDate">'+a[h].date+"</div>",b+='<div class="weatherForecastText">'+a[h].text+"</div>",
b+='<div class="weatherForecastRange">High: '+a[h].high+" Low: "+a[h].low+"</div>",b+="</div>";b+="</div>"}e.link&&(b+='<div class="weatherLink"><a href="'+c.link+'" target="'+e.linktarget+'" title="Read full forecast">Full forecast</a></div>')}else b='<div class="weatherItem '+m+'">',b+='<div class="weatherError">City not found</div>';b+="</div>";m="odd"==m?"even":"odd";f.append(b)},w=function(f){d=new Date;return r=new Date(d.toDateString()+" "+f)}})}})(jQuery);